## 서비스 소개
- 웹 서버가 하나든 수백 개든 상관없이 외부 클라이언트는 프론트엔드 파드에 연결할 수 있어야 한다.
- 프론트엔드 파드는 백엔드 데이터베이스에 연결해야 한다.

![image](https://user-images.githubusercontent.com/81672260/161502503-ec70777f-d86a-4583-ac8a-09e79b4ecd2d.png)

## 서비스 생성

- kubectl expose로 서비스 생성

```
kubectl create –f kubia-svc.yaml
kubectl get po
kubectl exec kubia-5dz2n – curl –s http://10.80.15.170
```

![image](https://user-images.githubusercontent.com/81672260/161507928-abafd268-d53b-4a0f-b36c-715a0a82a668.png)  
![image](https://user-images.githubusercontent.com/81672260/161507942-4b2dbe40-89a7-4ff9-9106-fca0ef8b01e1.png)  
![image](https://user-images.githubusercontent.com/81672260/161507960-a2e1f837-8fd5-49b9-92d9-759f548d1369.png)  

1. kubectl exec
2. curl은 node.js를 실행하고 있는 컨테이너 내에서 실행된다.
3. curl은 HTTP GET 요청을 보낸다.
4. 서비스는 HTTP연결을 임의의 파드로 전달한다.
5. HTTP 응답은 다시 curl로 전송된다.

## 서비스 세션 어피니티 구성
- 동일한 명령을 몇 번 더 실행하면 동일한 클라이언트에서 요청하더라도 서비스 프록시가 각 연결을 임의의 파드를 선택해 전달하기 때문에 요청할 때마다 다른 파드가 선택된다.
- 특정 클라이언트의 모든 요청을 매번 같은 파드로 리디렉션 하려면 세션어피니티(sessionAffinity)를 None대신 ClientIP로 설정한다.

![image](https://user-images.githubusercontent.com/81672260/161509411-a52f44cb-5c5e-4061-9d39-f1344efe4735.png)


## 서비스 검색
- 서비스를 만들면 파드에 액세스할 수 있는 안정적인 IP 주소와 포트가 생긴다.
- 항상 서비스의 IP 주소로 액세스할 수 있어야 한다.

1. 환경변수를 통한 서비스 검색
- 서비스에 대한 환경변수를 보려면 먼저 모든 파드를 삭제하고 rc에서 새로 파드를 만들어야한다.
```
kubectl delete po –all
```
2. DNS를 통한 서비스 검색




