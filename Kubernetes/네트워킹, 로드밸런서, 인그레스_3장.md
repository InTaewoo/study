#### 다룰내용
- 쿠버네티스 네트워킹
- 고급 서비스 개념
- 서비스 디스커버리
- DNS
네임스페이스 제한과 쿼타

## 쿠버네티스 네트워킹
- 각 파드에 IP를 필요로 한다
- 쿠버네티스는 컨테이너-컨테이너 , 컨테이너-노드 로의 트래픽에 대해 NAT사용을 허용하지 않음
- IP주소는 통신을 위해 사용되는 IP주소와 일치해야함

## 네트워킹 옵션
- 쿠버네티스는 넓은 범위의 네트워킹 옵션 제공
 
## 네트워킹 비교

### 도커
- 도커 엔진은 기본적으로 3가지 타입(브릿지,호스트,none)의 네트워크를 생성

## 고급 서비스

### kube-proxy
- 적합한 파드 IP와 포트를 결정하기 위해 사용함
- 쿠버네티스의 마스터 API를 모니터링
 
 
 ## 외부 서비스
 
 - LoadBalancer 타입


 ```
 kubectl describe service/node-js-labels
 ```
 
 ## 내부 서비스
 
 - 기본적인 서비스는 내부로만 열려있고 clusterIP 타입을 지정할 수 있지만 정의되어 있지 않다면 clsuterIP타입이 지정된 걸로 간주한다.

```
kubectl create -f nodejs-service-internal.yaml
kubectl get services -l name=node-js-internal
```

![image](https://user-images.githubusercontent.com/81672260/146883144-652f7c6e-dbe8-46d3-8477-cf3ec03076c4.png)

- 새로운 서비스가 생겼지만 하나의 IP만 가진다. 해당 IP는 외부에서 접근할 수 없다.

## 커스텀 로드밸런싱
- NodePort 타입의 서비스
- 호스트 또는 노드의 특정 포트를 통해 서비스를 노출
- 모든 노드의 IP 주소를 사용할 수 있으며 할당된 노드 포트로 서비스에 접근

```
kubectl create -f nodejs-service-nodePort.yaml
```

![image](https://user-images.githubusercontent.com/81672260/146891131-dcd824cb-e6f7-42fe-a881-d4d858fbeb30.png)
- 방화벽 포트를 열어야 한다는 메세지, 30001포트를 GCE 콘솔에서 개방

![image](https://user-images.githubusercontent.com/81672260/146893215-a6c10093-61bc-444b-bc76-8db0f372fc47.png)

## 커스텀 포트

- 서비스는 트래픽을 다른 포트로도 매핑할 수 있다. 90포트를 노출하고 80포트로 포워딩하는 서비스를 생성

![image](https://user-images.githubusercontent.com/81672260/147014188-4a9f4407-4929-4984-8bc3-217a202386c1.png)

```
kubectl create -f nodejs-customPort-controller.yaml
kubectl create -f nodejs-customPort-service.yaml
kubectl get services
```

![image](https://user-images.githubusercontent.com/81672260/147014277-b5dc705b-6855-4ffd-912e-224bad8e3c06.png)

- targetPort 엘리먼트는 파드 또는 컨테이너에 사용할 포트를 서비스에게 알려줌
- 80포트로 콘텐츠를 제공하면서 90포트로 서비스를 노출시킴

35.202.105.209:90

![image](https://user-images.githubusercontent.com/81672260/147014653-4032df35-aa6b-4cc7-ad14-22945d8a9bf7.png)


## 다중 포트
- HTTP 웹서버의 80, 8888포트처럼 많은 애플리케이션들이 여러 포트를 노출한다
